import{r as m,A as f,j as e,L as v}from"./index-qtsJ8Jwt.js";import{a as y}from"./index-B9ygI19o.js";function b(t){return t?t.trim().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}function E(t){if(!t)throw new Error("Email-ul este obligatoriu.");const a=t.trim().toLowerCase();if(!/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i.test(a))throw new Error("Email invalid.");return a}function C(t){if(!t)return null;let a=t.trim().replace(/\s+/g,"");if((a.match(/https?:\/\//gi)||[]).length>1)throw new Error("Este permis un singur website.");/^https?:\/\//i.test(a)||(a="https://"+a);try{const s=new URL(a);if(!["http:","https:"].includes(s.protocol))throw new Error;return s.href}catch{throw new Error("Website invalid.")}}function L({slug:t}){const[a,s]=m.useState([]),[u,c]=m.useState(""),[x,d]=m.useState(!0),h=m.useRef(Date.now()),[r,g]=m.useState({name:"",email:"",website:"",comment:"",company:"",gdpr:!1});m.useEffect(()=>{if(!t){d(!1);return}d(!0),y.get(`${f}/comments/?slug=${t}`).then(n=>{s(Array.isArray(n.data)?n.data:[])}).catch(()=>s([])).finally(()=>d(!1))},[t]);const l=n=>{const{name:i,value:o,type:p,checked:N}=n.target;g({...r,[i]:p==="checkbox"?N:o})},j=async n=>{if(n.preventDefault(),c(""),!t){c("Articol invalid.");return}if(Date.now()-h.current<5e3){c("Te rugăm să aștepți câteva secunde.");return}let i;try{i={slug:t,name:b(r.name),email:E(r.email),website:C(r.website),comment:b(r.comment),company:r.company,gdpr:r.gdpr}}catch(o){c(o.message);return}try{const o=await y.post(`${f}/comments/`,i);o.data?.id?(s(p=>[o.data,...p]),g({name:"",email:"",website:"",comment:"",company:"",gdpr:!1}),h.current=Date.now()):c("Comentariul nu a putut fi salvat.")}catch{c("Eroare la trimiterea comentariului.")}};return t?e.jsxs("section",{className:"mt-16",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Comentarii"}),x&&e.jsx("p",{className:"opacity-60",children:"Se încarcă comentariile…"}),!x&&a.length===0&&e.jsx("p",{className:"opacity-50 text-sm",children:"Nu există comentarii încă."}),a.map(n=>e.jsxs("div",{className:"border rounded-xl p-4 mb-4",children:[e.jsx("strong",{children:n.name}),e.jsx("p",{className:"text-xs opacity-60 mt-1",children:(()=>{if(!n.created_at)return"chiar acum";const i=new Date(n.created_at);return isNaN(i.getTime())?"chiar acum":i.toLocaleString("ro-RO")})()}),e.jsx("p",{className:"mt-2",children:n.comment})]},n.id)),e.jsxs("form",{onSubmit:j,className:"space-y-3 mt-8",children:[u&&e.jsx("p",{className:"text-red-500 text-sm",children:u}),e.jsx("input",{className:"w-full rounded-lg border px-3 py-2 text-sm",name:"name",placeholder:"Nume *",value:r.name,onChange:l,required:!0}),e.jsx("input",{className:"w-full rounded-lg border px-3 py-2 text-sm",type:"email",name:"email",placeholder:"Email *",value:r.email,onChange:l,required:!0}),e.jsx("input",{className:"w-full rounded-lg border px-3 py-2 text-sm",name:"website",placeholder:"Website (opțional)",value:r.website,onChange:l}),e.jsx("input",{type:"text",name:"company",value:r.company,onChange:l,className:"hidden"}),e.jsx("textarea",{className:"w-full rounded-lg border px-3 py-2 min-h-[120px] text-sm",name:"comment",placeholder:"Comentariu *",value:r.comment,onChange:l,required:!0}),e.jsxs("label",{className:"flex items-start gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",name:"gdpr",checked:r.gdpr,onChange:l,required:!0}),e.jsxs("span",{children:["Sunt de acord cu"," ",e.jsx(v,{to:"/privacy-policy",className:"underline",children:"Politica de confidențialitate"})]})]}),e.jsx("button",{className:"bg-violet-700 text-white px-4 py-2 rounded",children:"Trimite comentariu"})]})]}):null}function R(){return e.jsxs("article",{className:"max-w-4xl mx-auto px-4 py-10 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded w-3/4 mb-6"}),e.jsx("div",{className:"h-80 bg-gray-300 rounded-2xl mb-10"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-11/12"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-10/12"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-9/12"})]})]})}const w=(t="",a=160)=>t.length<=a?t:t.slice(0,a-1).trim()+"…",k=({title:t="",description:a="",image:s="",url:u=""})=>({title:w(t,60),description:w(a,160),image:s,url:u});export{R as A,L as C,k as b};
